# Проверка входных данных (валидация)

Проверка входных данных - это процесс проверки достоверности введенных пользователем данных перед их обработкой приложением.
Целью проверки входных данных является предотвращение инъекционных атак, которые происходят, когда злоумышленник вставляет вредоносный код (например, SQL, JavaScript или HTML) в приложение, используя уязвимости в полях ввода.

Инъекционные атаки могут происходить несколькими способами, но все они связаны с тем, что злоумышленник отправляет данные в приложение, которые не были должным образом проверены или очищены.

## Распространенные типы инъекционных атак

### SQL-инъекция

Этот тип атаки возникает, когда злоумышленник вставляет SQL-код в поле ввода, которое используется для запроса к базе данных.
Злоумышленник может использовать SQL-инъекцию для доступа к конфиденциальным данным или выполнения вредоносных команд в базе данных.

#### Пример

Допустим, в приложении есть панель поиска, которая позволяет пользователям искать продукты по названию. Приложение может создать **SQL-запрос** для поиска продуктов на основе поискового запроса, введенного пользователем.
Однако, если приложение не выполняет надлежащую валидацию, злоумышленник может ввести SQL-код в строку поиска, который будет выполнен приложением.
Например, злоумышленник может ввести следующий поисковый запрос: `OR 1=1 --`. Это может привести к тому, что SQL-запрос вернет все продукты в базе данных, независимо от поискового запроса, введенного пользователем. 

### Атака с использованием межсайтового скриптинга (XSS)

Этот тип атаки возникает, когда злоумышленник вводит вредоносный код JavaScript в поле ввода, которое отображается другим пользователям.
Злоумышленник может использовать XSS для кражи конфиденциальных данных, таких как сеансовые файлы cookie, или для перенаправления пользователей на вредоносный веб-сайт. 

#### Пример

Допустим, в приложении есть раздел, где пользователи могут оставлять комментарии. Приложение может отображать комментарии на веб-странице без надлежащей валидации данных.
Злоумышленник может опубликовать комментарий, содержащий вредоносный код JavaScript, который будет выполнен другими пользователями, просматривающими этот комментарий.
Например, злоумышленник может опубликовать следующий комментарий: `<script> alert('You have been hacked!'); </script>`. Это приведет к появлению окна предупреждения на экранах всех пользователей, просматривающих комментарий. 

### Внедрение команд (sh-команды)

Этот тип атаки происходит, когда злоумышленник вставляет вредоносные команды в поле ввода, которое используется для выполнения системных команд.
Злоумышленник может использовать внедрение команд для выполнения произвольных команд на сервере. 

Чтобы обезопасить приложение от атак с использованием инъекций, проверка входных данных должна выполняться для всех полей ввода в приложении.

#### Пример

Допустим, в приложении есть функция, которая позволяет пользователям загружать файлы. Приложение может использовать системную команду для обработки загруженного файла без надлежащей валидации входных данных.
Злоумышленник может загрузить файл, содержащий вредоносные команды, которые будут выполняться приложением.
Например, злоумышленник может загрузить файл со следующим именем: `; rm -rf /`. Это приведет к тому, что приложение выполнит `rm -rf /` команда, которая удалит все файлы на сервере. 

В действительности, большинство сайтов и приложений обладают внутренней защитой, либо разработчики позаботились о том, чтобы обеспечить её. Поэтому подобные примеры вряд ли можно будет протестировать на большинстве сайтов.
Иначе, уже **в текущей статье**, было бы возможно наблюдать всплывающее сообщение "You have been hacked!"...

## Виды проверок

### Белый список

Прием только тех входных данных, которые соответствуют заранее определенному набору значений.
Например, принимать только буквенно-цифровые символы для поля имени пользователя.

```js
const usernameInput = document.getElementById('username');
usernameInput.addEventListener('input', function(event) {
  const regex = /^[a-zA-Z0-9]+$/;
  const input = event.target.value;
  if (!regex.test(input)) {
    // Показать ошибку ввода
    // Не дать отправить форму
  }
});
```

### Черный список

Отклонение ввода, соответствующего заранее определенному набору значений.
Например, отклонение любого ввода, содержащего специальные символы, такие как кавычки или точки с запятой.

```js
const phoneInput = document.getElementById('phone');
 
phoneInput.addEventListener('input', function(event) {
  const blacklist = /['";<>]/;
  const input = event.target.value;
 
  if (blacklist.test(input)) {
    // Показать ошибку ввода
    // Не дать отправить форму
  }
});
```

### Очистка

Удаление или кодирование любых потенциально вредоносных символов из входных данных перед их обработкой.
Например, преобразование любых HTML-тегов в соответствующие им HTML-объекты. 

```js
const commentInput = document.getElementById('comment');
 
commentInput.addEventListener('input', function(event) {
  const input = event.target.value;
  const sanitizedInput = input.replace(/</g, '<').replace(/>/g, '>');
});
```

## Достаточно ли этих проверок?

Определенно, нет. Все проверки и валидации, которые производятся на стороне frontend обходимы.
Проверка и очистка на стороне клиента могут быть полезны для обеспечения немедленной обратной связи с пользователем и снижения нагрузки на сервер за счет обнаружения явно неверных входных данных до их отправки на серверную часть.
Однако важно помнить, что любые меры безопасности, реализуемые исключительно на стороне клиента, могут быть обойдены мотивированным злоумышленником.

Чтобы обеспечить надежную защиту от атак с использованием инъекций, важно также выполнять двустороннюю валидацию - одна на frontend-стороне, вторая на сервере.
Это гарантирует, что любой вредоносный ввод будет перехвачен и отклонен до того, как он может быть обработан и потенциально нанести ущерб приложению или его пользователям.

Таким образом, **проверку и очистку входных данных на стороне клиента следует рассматривать как дополнительный уровень безопасности, а не как единственное средство предотвращения инъекционных атак.**
Комбинация проверки и очистки на стороне клиента и сервера является наиболее эффективным способом защиты от инъекционных атак.